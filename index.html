<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Catch Me If You Can - $CATCH</title>
    <link rel="stylesheet" href="css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <header class="hero">
        <h1>$CATCH - Catch Me If You Can</h1>
        <p>The faster you click, the more you earn.<br>Reflex is the only utility.</p>
        <div class="buttons">
            <a href="https://pump.fun" target="_blank" class="btn">Buy $CATCH</a>
            <a href="https://t.me/yourcommunity" target="_blank" class="btn">Community</a>
        </div>
    </header>

    <section class="game-section">
        <h2>🎮 Reflex Game</h2>
        <div id="game-area">
            <div id="item"></div>
        </div>
        <div id="game-ui">
            <p>Round: <span id="round">0</span></p>
            <p>Lives: <span id="lives">❤️❤️❤️❤️❤️</span></p>
            <p id="message">Catch the item before it hits the ground!</p>
            <input type="text" id="wallet-input" style="display:none;" placeholder="Enter your wallet address">
            <button id="submit-score" style="display:none;">Submit Score</button>
        </div>
        <button id="start-btn">Start Game</button>
    </section>

    <section class="leaderboard">
        <h2>🏆 Daily Top 10</h2>
        <ul id="leaderboard-list">
            <li id="slot-1">-</li>
            <li id="slot-2">-</li>
            <li id="slot-3">-</li>
            <li id="slot-4">-</li>
            <li id="slot-5">-</li>
            <li id="slot-6">-</li>
            <li id="slot-7">-</li>
            <li id="slot-8">-</li>
            <li id="slot-9">-</li>
            <li id="slot-10">-</li>
            <li id="slot-11">-</li>
            <li id="slot-12">-</li>
            <li id="slot-13">-</li>
            <li id="slot-14">-</li>
            <li id="slot-15">-</li>
            <li id="slot-16">-</li>
            <li id="slot-17">-</li>
            <li id="slot-18">-</li>
            <li id="slot-19">-</li>
            <li id="slot-20">-</li>
            <li id="slot-21">-</li>
            <li id="slot-22">-</li>
            <li id="slot-23">-</li>
            <li id="slot-24">-</li>
            <li id="slot-25">-</li>
            <li id="slot-26">-</li>
            <li id="slot-27">-</li>
            <li id="slot-28">-</li>
            <li id="slot-29">-</li>
            <li id="slot-30">-</li>
            <li id="slot-31">-</li>
            <li id="slot-32">-</li>
            <li id="slot-33">-</li>
            <li id="slot-34">-</li>
            <li id="slot-35">-</li>
            <li id="slot-36">-</li>
            <li id="slot-37">-</li>
            <li id="slot-38">-</li>
            <li id="slot-39">-</li>
            <li id="slot-40">-</li>
            <li id="slot-41">-</li>
            <li id="slot-42">-</li>
            <li id="slot-43">-</li>
            <li id="slot-44">-</li>
            <li id="slot-45">-</li>
            <li id="slot-46">-</li>
            <li id="slot-47">-</li>
            <li id="slot-48">-</li>
            <li id="slot-49">-</li>
            <li id="slot-50">-</li>
        </ul>
        <p class="note">Top 10 players split 90% of creator fees — based on $CATCH holdings.</p>
    </section>

    <footer class="footer">
        <p>No roadmap. No promises. Just click.</p>
        <p>Powered by memes, sweat, and broken mice. 🐭</p>
    </footer>

<script src="js/script.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
(function() {
  const sbClient = supabase.createClient(
    "https://jolxfdmhevjtwbfvhyeu.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpvbHhmZG1oZXZqdHdiZnZoeWV1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4Mjg2MzgsImV4cCI6MjA2NTQwNDYzOH0.ujZGETytKXZHEW0fwJYqfALbib5DX3uTC0g6ZFbfjis"
  );

  async function submitToSupabase(wallet, score) {
    const { data, error } = await sbClient.from("scores").insert([{ wallet, score }]);
    if (error) {
      console.error("❌ Submit failed:", error);
    } else {
      console.log("✅ Submit success");
    }
  }

  // 내부 전용으로만 노출
  window._submitToSupabase = submitToSupabase;
  window._sbClient = sbClient;

  // 콘솔에서 막기 위한 Object.freeze
  Object.freeze(window._submitToSupabase);
  Object.freeze(window._sbClient);
})();
</script>
  // ✅ 랭킹 불러오기
  async function fetchLeaderboardFromSupabase() {
    const { data, error } = await sb
      .from("scores")
      .select("*")
      .order("score", { ascending: false })
      .limit(50);

    if (error) return console.error("❌ Fetch error:", error);

    const leaderboardList = document.getElementById("leaderboard-list");
    leaderboardList.innerHTML = "";
    data.forEach((entry, idx) => {
      const li = document.createElement("li");
      const masked = entry.wallet.slice(0, 4) + "..." + entry.wallet.slice(-4);
      li.textContent = ${idx + 1}. ${masked} - ${entry.score};
      leaderboardList.appendChild(li);
    });
  }

  // ✅ 페이지 로드 시 실행
  window.addEventListener("DOMContentLoaded", fetchLeaderboardFromSupabase);

  // ✅ js에서 호출할 수 있도록 내부 함수만 넘김
  window._internalSubmitScore = submitToSupabase;
</script>

</body>
</html>

내 html 이고

const emojis = ["🍕", "💩", "🧻", "🪙", "🧠", "🪞", "🍩", "💣", "😺", "👻", "🛸", "🎯"];
let round = 0;
let speed = 3000;
let falling = false;
let gameArea = document.getElementById("game-area");
let item = document.getElementById("item");
let roundDisplay = document.getElementById("round");
let message = document.getElementById("message");
let startBtn = document.getElementById("start-btn");
let leaderboardList = document.getElementById("leaderboard-list");
let submitBtn = document.getElementById("submit-score");
let walletInput = document.getElementById("wallet-input");
let livesDisplay = document.getElementById("lives");
let catchSound = new Audio("sound/catch.mp3");

let gameTimer;
let lives = 5;
let canSubmit = false;

function randomEmoji() {
    return emojis[Math.floor(Math.random() * emojis.length)];
}

function resetItem() {
    const size = Math.floor(Math.random() * 20) + 40;
    const rotation = Math.floor(Math.random() * 60) - 30;
    const left = Math.floor(Math.random() * 180) + 60;
    const hue = Math.floor(Math.random() * 360);
    const brightness = 0.8 + Math.random() * 0.4;
    item.style.left = left + "px";
    item.style.top = "-60px";
    item.style.fontSize = size + "px";
    item.style.transform = rotate(${rotation}deg);
    item.textContent = randomEmoji();
    item.style.filter = brightness(${brightness}) hue-rotate(${hue}deg);
}

function startRound() {
    round++;
    speed = Math.max(600, speed - 100);
    roundDisplay.textContent = round;
    resetItem();
    falling = true;
    item.style.display = "block";
    let posY = -60;
    let baseX = parseInt(item.style.left);
    let t = 0;
    clearInterval(gameTimer);
    gameTimer = setInterval(() => {
        if (!falling) return;
        t += 0.1;
        posY += 5;
        const offsetX = Math.sin(t * 2) * 40;
        item.style.top = posY + "px";
        item.style.left = (baseX + offsetX) + "px";
        if (posY > 500) {
            missItem();
        }
    }, speed / 100);
}

function missItem() {
    falling = false;
    item.style.display = "none";
    lives--;
    updateLivesDisplay();
    if (lives <= 0) {
        endGame();
    } else {
        setTimeout(startRound, 1000);
    }
}

function updateLivesDisplay() {
    livesDisplay.textContent = "❤️".repeat(lives) + "🖤".repeat(5 - lives);
}

item.onclick = () => {
    if (!falling) return;
    falling = false;
    item.style.display = "none";
    catchSound.currentTime = 0;
    catchSound.play();
    message.textContent = ["EZ 😎", "Too slow bro?", "Next round!", "Not bad.", "LOL ok then"][Math.floor(Math.random() * 5)];
    setTimeout(startRound, 1000);
};

function endGame() {
    falling = false;
    clearInterval(gameTimer);
    item.style.display = "none";
    message.textContent = 💀 Game Over at round ${round}!;
    walletInput.style.display = "inline-block";
    submitBtn.style.display = "inline-block";
    startBtn.disabled = false;
    canSubmit = true;
}

async function submitScore() {
    if (!canSubmit) return alert("You already submitted your score.");
    const addr = walletInput.value.trim();
    if (addr.length < 8) return alert("Wallet address too short!");
    walletInput.value = "";
    canSubmit = false;

    // Supabase에 저장
if (typeof window._submitToSupabase === "function") {
    await window._submitToSupabase(addr, round);
        await loadLeaderboard();
    } else {
        console.warn("⚠ submitToSupabase is not defined");
    }
}

async function loadLeaderboard() {
const { data, error } = await window._sbClient
        .from("scores")
        .select("*")
        .order("score", { ascending: false })
        .limit(50);

    if (error) {
        console.error("❌ Failed to load leaderboard:", error);
        return;
    }

    leaderboardList.innerHTML = "";
    data.forEach((entry, idx) => {
        const li = document.createElement("li");
        const masked = entry.wallet.slice(0, 4) + "..." + entry.wallet.slice(-4);
        li.textContent = ${idx + 1}. ${masked} - ${entry.score};
        if (idx === 0) li.classList.add("top-1");
        else if (idx === 1) li.classList.add("top-2");
        else if (idx === 2) li.classList.add("top-3");
        else if (idx < 10) li.classList.add("top-10");
        leaderboardList.appendChild(li);
    });
}

startBtn.onclick = () => {
    round = 0;
    speed = 3000;
    lives = 5;
    updateLivesDisplay();
    startBtn.disabled = true;
    walletInput.style.display = "none";
    submitBtn.style.display = "none";
    message.textContent = "Catch the item before it hits the ground!";
    canSubmit = false;
    startRound();
    loadLeaderboard(); // 게임 시작할 때 최신 랭킹 불러오기
};

submitBtn.onclick = submitScore;

// 페이지 로드시 초기 랭킹 표시
window.onload = loadLeaderboard;
